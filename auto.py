import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import datetime
import random

# ======= è¨­å®šã‚¨ãƒªã‚¢ =======
GMAIL_USER = "japantopworld@gmail.com"
APP_PASSWORD = "agrq jmit jxvz nrdt"  # â†Gmailã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆåŠè§’ã‚¹ãƒšãƒ¼ã‚¹OKï¼‰
TO_EMAIL = "taka9121@icloud.com"
# ===========================

# ä»®AIäºˆæƒ³ï¼ˆç«¶è‰‡ãƒ»ç«¶é¦¬ãƒ©ãƒ³ãƒ€ãƒ äºˆæƒ³ï¼‰
def make_predictions(label, race_list):
    result = f"ğŸ“Š {label} AIäºˆæƒ³ ä¸Šä½5ä»¶ï¼š\n"
    for i, race in enumerate(race_list[:5]):
        players = race["é¸æ‰‹"]
        shuffled = players.copy()
        random.shuffle(shuffled)
        result += f"\nç¬¬{i+1}Rï¼š{shuffled[0]} â†’ {shuffled[1]} â†’ {shuffled[2]}"
    return result

# ä»®ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ï¼ˆç«¶è‰‡6ãƒ¬ãƒ¼ã‚¹ãƒ»ç«¶é¦¬5ãƒ¬ãƒ¼ã‚¹ï¼‰
boat_races = [
    {"é¸æ‰‹": ["ä»Šå£å…‰å¤ªéƒ", "ç™½äº•è‹±æ²»", "å³°ç«œå¤ª", "æ¯’å³¶èª ", "ç“œç”Ÿæ­£ç¾©", "å¹³æœ¬çœŸä¹‹"]},
    {"é¸æ‰‹": ["æ¡ç”Ÿé †å¹³", "èµ¤å²©å–„ç”Ÿ", "æ¾äº•ç¹", "çŸ³é‡è²´ä¹‹", "å²¡å´æ­è£•", "äº•å£ä½³å…¸"]},
    {"é¸æ‰‹": ["å¯ºç”°ç¥¥", "æ¿±é‡è°·æ†²å¾", "è¥¿å±±è²´æµ©", "ç¯ å´å…ƒå¿—", "å‰æœ¬æ³°å’Œ", "èŒ…åŸæ‚ ç´€"]},
    {"é¸æ‰‹": ["é¦¬å ´è²´ä¹Ÿ", "çŸ³æ¸¡é‰„å…µ", "å±±å£å‰›", "ç”°æ‘éš†ä¿¡", "èŠåœ°å­å¹³", "å±±ç”°åº·äºŒ"]},
    {"é¸æ‰‹": ["å²¡å´æ­è£•", "ç™½äº•è‹±æ²»", "å¹³é«˜å¥ˆèœ", "å¤§å±±åƒåºƒ", "é è—¤ã‚¨ãƒŸ", "å®ˆå±‹ç¾ç©‚"]},
    {"é¸æ‰‹": ["äº•å£ä½³å…¸", "æ¯’å³¶èª ", "å³°ç«œå¤ª", "æ¡ç”Ÿé †å¹³", "çŸ³é‡è²´ä¹‹", "æ¾äº•ç¹"]}
]

horse_races = [
    {"é¸æ‰‹": ["ã‚¤ã‚¯ã‚¤ãƒãƒƒã‚¯ã‚¹", "ãƒ‰ã‚¦ãƒ‡ãƒ¥ãƒ¼ã‚¹", "ã‚¸ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ãƒ‘ãƒ¬ã‚¹", "ã‚¹ã‚¿ãƒ¼ã‚ºã‚ªãƒ³ã‚¢ãƒ¼ã‚¹", "ã‚¿ã‚¤ãƒˆãƒ«ãƒ›ãƒ«ãƒ€ãƒ¼", "ã‚½ãƒ¼ãƒ«ã‚ªãƒªã‚¨ãƒ³ã‚¹"]},
    {"é¸æ‰‹": ["ãƒªãƒãƒ†ã‚£ã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰", "ã‚½ãƒ³ã‚°ãƒ©ã‚¤ãƒ³", "ãƒŠãƒŸãƒ¥ãƒ¼ãƒ«", "ã‚µã‚¦ãƒ³ã‚ºã‚ªãƒ–ã‚¢ãƒ¼ã‚¹", "ã‚·ãƒ£ãƒ•ãƒªãƒ¤ãƒ¼ãƒ«", "ãƒ€ãƒãƒ³ãƒ™ãƒ«ãƒ¼ã‚¬"]},
    {"é¸æ‰‹": ["ãƒ‘ãƒ³ã‚µãƒ©ãƒƒã‚µ", "ã‚¸ã‚ªã‚°ãƒªãƒ•", "ãƒ´ã‚§ãƒ©ã‚¢ã‚ºãƒ¼ãƒ«", "ã‚­ã‚¿ã‚µãƒ³ãƒ–ãƒ©ãƒƒã‚¯", "ã‚·ãƒ³ãƒœãƒªã‚¯ãƒªã‚¹ã‚¨ã‚¹", "ã‚¨ãƒ•ãƒ•ã‚©ãƒ¼ãƒªã‚¢"]},
    {"é¸æ‰‹": ["ã‚°ãƒ©ãƒ³ã‚¢ãƒ¬ã‚°ãƒªã‚¢", "ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ã‚¢ã‚¤", "ã‚¯ãƒ­ãƒã‚¸ã‚§ãƒã‚·ã‚¹", "ãƒ©ãƒƒã‚­ãƒ¼ãƒ©ã‚¤ãƒ©ãƒƒã‚¯", "ã‚µãƒ¼ãƒˆã‚¥ãƒ«ãƒŠãƒ¼ãƒªã‚¢", "ãƒ•ã‚£ã‚¨ãƒ¼ãƒ«ãƒãƒ³"]},
    {"é¸æ‰‹": ["ãƒ‰ã‚¥ãƒ©ãƒ¡ãƒ³ãƒ†", "ã‚³ãƒ³ãƒˆãƒ¬ã‚¤ãƒ«", "ã‚¢ã‚¹ã‚¯ãƒ“ã‚¯ã‚¿ãƒ¼ãƒ¢ã‚¢", "ã‚·ãƒ³ãƒãƒ©ã‚¤ãƒˆ", "ãƒªã‚¢ã‚¢ãƒ¡ãƒªã‚¢", "ãƒã‚«ãƒ’ã‚­"]}
]

# æ—¥ä»˜ã¨æœ¬æ–‡ç”Ÿæˆ
jst_now = datetime.datetime.utcnow() + datetime.timedelta(hours=9)
today_str = jst_now.strftime("%Y-%m-%d")

boat_predictions = make_predictions("ğŸš¤ ç«¶è‰‡", boat_races)
horse_predictions = make_predictions("ğŸ ç«¶é¦¬", horse_races)

body = f"""ğŸ“… {today_str} ã®AIäºˆæƒ³çµæœ

{boat_predictions}

-------------------------------

{horse_predictions}

ğŸ“© Powered by è³­ç¥æ§˜AIï¼ˆä»®ï¼‰
"""

# ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†
msg = MIMEMultipart()
msg["Subject"] = f"{today_str}ï¼šç«¶è‰‡ãƒ»ç«¶é¦¬AIäºˆæƒ³ï¼ˆä¸Šä½5ï¼‰"
msg["From"] = GMAIL_USER
msg["To"] = TO_EMAIL
msg.attach(MIMEText(body, "plain"))

try:
    with smtplib.SMTP_SSL("smtp.gmail.com", 465) as server:
        server.login(GMAIL_USER, APP_PASSWORD)
        server.send_message(msg)
    print("âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ï¼")
except Exception as e:
    print("âŒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ:", e)
